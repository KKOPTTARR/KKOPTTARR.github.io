<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      href="https://fonts.googleapis.com/css?family=Pacifico|Varela+Round&display=swap"
      rel="stylesheet"
    />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
      body {
        font-family: "Varela Round", sans-serif;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        position: relative;
        background: #dadde6;
      }
      h1 {
        font-family: "Pacifico", cursive;
        font-size: 4rem;
        color: azure;
        z-index: 1;
        text-shadow: 2px 2px rgba(0, 0, 0, 0.1);
        animation: colorchange 3s infinite; /* Add this line */
      }
      button {
        font-family: "Varela Round", sans-serif;
        background-color: #9ec3f0;
        border: none;
        border-radius: 50px;
        padding: 10px 20px;
        color: white;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.4s ease;
        z-index: 1;
      }
      button:hover {
        background-color: #b2f2ff;
      }
      .topLeft {
        position: absolute;
        top: 15px;
        left: 15px;
      }
      .topRight {
        position: absolute;
        top: 15px;
        right: 15px;
      }
      .bottomLeft {
        /* Add this class for positioning the change background color button */
        position: absolute;
        bottom: 15px;
        left: 15px;
      }
      .background-pattern {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
      }
      .background-pattern span {
        position: absolute;
        font-size: 16px;
      }

      /*十种颜色*/
      @keyframes colorchange {
        0% {
          color: azure;
        }
        10% {
          color: #78aef1;
        }
        20% {
          color: #ffcbc1;
        }
        30% {
          color: #c1ffd4;
        }
        40% {
          color: #f5f794;
        }
        50% {
          color: #f7c5ff;
        }
        60% {
          color: #fa8c67;
        }
        70% {
          color: #bceef8;
        }
        80% {
          color: #8a8a6c;
        }
        90% {
          color: #fa13c0;
        }
        100% {
          color: #0d8807;
        }
      }

      canvas {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 0;
      }
    </style>
    <title>Fun Mooncake</title>
    <script>
      function generateRandomShape() {
        const shapes = ["circle", "triangle", "square"];
        return shapes[Math.floor(Math.random() * shapes.length)];
      }

      function generateRandomSize() {
        return Math.random() * 20 + 10;
      }

      function generateRandomColor() {
        return `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${
          Math.random() * 255
        }, 0.8)`;
      }

      function generateRandomPosition() {
        return {
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
        };
      }

      function generateRandomVelocity() {
        return {
          x: (Math.random() - 0.5) * 2,
          y: (Math.random() - 0.5) * 2,
        };
      }

      function generateRandomShapeParticle() {
        const shape = generateRandomShape();
        const size = generateRandomSize();
        const color = generateRandomColor();
        const position = generateRandomPosition();
        const velocity = generateRandomVelocity();
        return new Particle(
          position.x,
          position.y,
          size,
          color,
          velocity,
          shape
        );
      }

      // Update Particle class to include shape property
      function Particle(x, y, size, color, velocity, shape) {
        // ... existing Particle constructor ...
        this.shape = shape;
      }

      // Modify createParticles to generate shape particles
      function createParticles() {
        for (let i = 0; i < numParticles; i++) {
          particles.push(generateRandomShapeParticle());
        }
      }

      window.addEventListener("DOMContentLoaded", () => {
        const backgroundPattern = createBackgroundPattern();
        document.body.appendChild(backgroundPattern);
      });
    </script>
  </head>
  <body>
    <div class="container">
      <h1 id="greeting">Hi, Mooncake!</h1>
    </div>
    <button class="topLeft" onclick="changeGreeting()">wisdom</button>
    <input
      type="file"
      id="imageInput"
      class="topRight"
      accept="image/*"
      style="visibility: hidden"
    />
    <button
      class="topRight"
      onclick="document.getElementById('imageInput').click()"
      style="top: unset; bottom: 15px"
    >
      Image
    </button>
    <button class="bottomLeft" onclick="changeBackgroundColor()">Color</button>
    <canvas id="backgroundCanvas"></canvas>
    <script src="config.js"></script>
    <script>
      const greetings = window.greetings;
      let shownGreetings = ["Hi, Mooncake!"];
      function changeGreeting() {
        if (shownGreetings.length === greetings.length) {
          shownGreetings = [];
        }

        let randomGreeting = "";
        do {
          randomGreeting =
            greetings[Math.floor(Math.random() * greetings.length)];
        } while (shownGreetings.includes(randomGreeting));

        shownGreetings.push(randomGreeting);
        document.getElementById("greeting").textContent = randomGreeting;

        const uploadedImage = sessionStorage.getItem("uploadedImage");
        if (uploadedImage) {
          document.body.style.backgroundImage = `url(${uploadedImage})`;
        }
      }

      // To handle uploaded image files
      document.getElementById("imageInput").addEventListener(
        "change",
        (e) => {
          const reader = new FileReader();
          reader.onload = function (event) {
            sessionStorage.setItem("uploadedImage", event.target.result);
            document.body.style.backgroundImage = `url(${event.target.result})`;
          };
          reader.readAsDataURL(e.target.files[0]);
          e.target.value = null; // reset the input value
        },
        false
      );

      function changeBackgroundColor() {
        const backgroundColors = [
          "#dadde6",
          "#ffc7c7",
          "#c7fffd",
          "#c7d3ff",
          "#e6c7ff",
          "#daffc7",
        ];
        let currentBackgroundColor = document.body.style.backgroundColor;

        let newBackgroundColor = "";
        do {
          newBackgroundColor =
            backgroundColors[
              Math.floor(Math.random() * backgroundColors.length)
            ];
        } while (currentBackgroundColor === newBackgroundColor);

        document.body.style.backgroundColor = newBackgroundColor;
      }

      const canvas = document.getElementById("backgroundCanvas");
      const ctx = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const particles = [];
      const numParticles = 150;

      function Particle(x, y, radius, color) {
        this.x = x;
        this.y = y;
        this.radius = radius;
        this.color = color;
        this.velocity = {
          x: (Math.random() - 0.5) * 3,
          y: (Math.random() - 0.5) * 3,
        };
      }

      Particle.prototype.draw = function () {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
        ctx.fillStyle = this.color;
        ctx.fill();
      };

      Particle.prototype.update = function () {
        this.x += this.velocity.x;
        this.y += this.velocity.y;

        if (this.x + this.radius > canvas.width || this.x - this.radius < 0) {
          this.velocity.x = -this.velocity.x;
        }

        if (this.y + this.radius > canvas.height || this.y - this.radius < 0) {
          this.velocity.y = -this.velocity.y;
        }

        this.draw();
      };

      function createParticles() {
        for (let i = 0; i < numParticles; i++) {
          const x = Math.random() * canvas.width;
          const y = Math.random() * canvas.height;
          const radius = Math.random() * 3 + 1;
          const color = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${
            Math.random() * 255
          }, 0.6)`;
          particles.push(new Particle(x, y, radius, color));
        }
      }

      function animateParticles() {
        requestAnimationFrame(animateParticles);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach((particle) => particle.update());
      }

      // Mouse interaction
      canvas.addEventListener("mousemove", (event) => {
        particles.forEach((particle) => {
          const dx = event.clientX - particle.x;
          const dy = event.clientY - particle.y;
          const distance = Math.sqrt(dx * dx + dy * dy);

          if (distance < 150) {
            particle.velocity.x = dx / 20;
            particle.velocity.y = dy / 20;
          }
        });
      });

      createParticles();
      animateParticles();
    </script>
  </body>
</html>
